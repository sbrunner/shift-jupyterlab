#!/usr/bin/env python3


import glob
import os
import subprocess

if __name__ == "__main__":
    imported_html_filed = set(glob.glob("*.html"))
    print("<html>")
    print("<head>")
    print("<title>Index of charts</title>")
    print("</head>")
    print("<body>")
    for file in glob.glob("*.ipynb"):
        subprocess.run(["jupyter", "nbconvert", "--to=notebook", "--execute", file], check=True)
        new_html_files = set(glob.glob("*.html")) - imported_html_filed
        if new_html_files:
            imported_html_filed.update(new_html_files)
            print("<p>")
            print(
                f'<em>Files generated by <code>{file}<code> from <a href="https://github.com/'
                f'{os.environ.get("GITHUB_REPOSITORY", "")}">shifter-pandas</a>:</em><br>'
            )
            for html_file in new_html_files:
                print(f'<a href="{html_file}">{os.path.splitext(html_file)[0]}</a><br>')
    print("</body>")
    print("</html>")

    for file in glob.glob("**/*.ipynb"):
        subprocess.run(["jupyter", "nbconvert", "--to=notebook", "--execute", file], check=True)
